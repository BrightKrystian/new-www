{"componentChunkName":"component---src-templates-post-template-tsx","path":"/blog/coremotion-pedometer-swift","result":{"data":{"markdownRemark":{"html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fd987c5f63a90bbbd59135aef2ea928c/eea4a/footsteps.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.89189189189189%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECBP/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAG1pedSf//EABcQAQEBAQAAAAAAAAAAAAAAAAEAAhL/2gAIAQEAAQUCzkuRnFlupb//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAwEBPwEn/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFxAAAwEAAAAAAAAAAAAAAAAAARAgMf/aAAgBAQAGPwLIK//EABgQAQADAQAAAAAAAAAAAAAAAAABESEx/9oACAEBAAE/IaRsxDaTjHCW3//aAAwDAQACAAMAAAAQoy//xAAWEQEBAQAAAAAAAAAAAAAAAAABEBH/2gAIAQMBAT8QOs//xAAWEQEBAQAAAAAAAAAAAAAAAAABECH/2gAIAQIBAT8QDZ//xAAZEAEAAwEBAAAAAAAAAAAAAAABABEhMYH/2gAIAQEAAT8QFaj7HUBvKgWDMS0mpq7ENn//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"footsteps image\"\n        title=\"footsteps image\"\n        src=\"/static/fd987c5f63a90bbbd59135aef2ea928c/1c72d/footsteps.jpg\"\n        srcset=\"/static/fd987c5f63a90bbbd59135aef2ea928c/a80bd/footsteps.jpg 148w,\n/static/fd987c5f63a90bbbd59135aef2ea928c/1c91a/footsteps.jpg 295w,\n/static/fd987c5f63a90bbbd59135aef2ea928c/1c72d/footsteps.jpg 590w,\n/static/fd987c5f63a90bbbd59135aef2ea928c/a8a14/footsteps.jpg 885w,\n/static/fd987c5f63a90bbbd59135aef2ea928c/fbd2c/footsteps.jpg 1180w,\n/static/fd987c5f63a90bbbd59135aef2ea928c/eea4a/footsteps.jpg 1280w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Ok... but what the pedometer is? Here you have a wikipedia definition:</p>\n<blockquote>\n<p>A pedometer is a device, usually portable and electronic or electromechanical, that counts each step a person takes by detecting the motion of the person's hands or hips.</p>\n</blockquote>\n<p>and YES, you can create your own pedometer using iOS framework called CoreMotion.</p>\n<p>CoreMotion is a well-known iOS framework. As we could read in <a href=\"https://developer.apple.com/documentation/coremotion\">docs</a> it processes accelerometer, gyroscope, pedometer environment-related events.\nIn this post I want to focus on the pedometer events and how to handle them.</p>\n<h2>Overview</h2>\n<h3>CMPedometer</h3>\n<p>In order to use CoreMotion pedometer, we need to take a closer look at <code>CMPedometer</code> class. It allows the user to retrieve some information about steps taken in the past, for example: How many steps I have done for last 3 days? Another usage of <code>CMPedometer</code> class is to get the live updates about steps taken already.</p>\n<pre><code class=\"language-swift\">open func queryPedometerData(from start: Date, to end: Date, withHandler handler: @escaping CoreMotion.CMPedometerHandler)\n\nopen func startUpdates(from start: Date, withHandler handler: @escaping CoreMotion.CMPedometerHandler)\n</code></pre>\n<h3>CMPedometerData</h3>\n<p>Another class that should catch our attention is <code>CMPedometerData</code>. This class represents data that will be sent with every update in the above functions. It contains a lot of useful information like:</p>\n<ul>\n<li><code>numberOfSteps: NSNumber?</code></li>\n<li><code>distance: NSNumber?</code></li>\n<li><code>currentPace: NSNumber?</code></li>\n<li><code>floorsAscended: NSNumber?</code></li>\n<li><code>floorsDescended: NSNumber?</code></li>\n</ul>\n<h3>CMMotionActivityManager</h3>\n<p>If we want to start counting steps, it will be good to know about what kind of activity our user is doing at the moment. Here with some help comes the <code>CMMotionActivityManager</code> class. Using th e instance of this class we are able to get updates about the user activity type. In order to do this we should call:</p>\n<pre><code class=\"language-swift\">open func startActivityUpdates(to queue: OperationQueue, withHandler handler: @escaping CoreMotion.CMMotionActivityHandler)\n</code></pre>\n<p>and the result of that is getting updates with <code>CMMotionActivity</code> which represents  data for a single motion event update. This data is a pack of bool values:</p>\n<ul>\n<li><code>stationary: Bool</code></li>\n<li><code>walking: Bool</code></li>\n<li><code>running: Bool</code></li>\n<li><code>automotive: Bool</code></li>\n<li><code>cycling: Bool</code></li>\n<li><code>unknown: Bool</code></li>\n</ul>\n<h2>Code step by step...</h2>\n<h3>1. Add <code>NSMotionUsageDescription</code> to your <code>info.plist</code></h3>\n<p>As we can read in <a href=\"https://developer.apple.com/documentation/coremotion\">Apple docs</a></p>\n<blockquote>\n<p>Important\nAn iOS app linked on or after iOS 10.0 must include usage description keys in its Info.plist file for the types of data it needs. Failure to include these keys will cause the app to crash. To >access motion and fitness data specifically, it must include NSMotionUsageDescription.</p>\n</blockquote>\n<p>So add to your <code>info.plist</code> <code>NSMotionUsageDescription</code> key modifying plain file:</p>\n<pre><code class=\"language-xml\">&#x3C;key>NSMotionUsageDescription&#x3C;/key>\n&#x3C;string>In order to count steps I need an access to your pedometer&#x3C;/string>\n</code></pre>\n<p>or adding new key via Xcode</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c714c2041521f0a12d5df1033a40e76b/3cd52/info-plist-motion-usage.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 2.0270270270270268%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAVUlEQVQI1yXGsQ5AMBQFUP+/0b5FpJb6AyFVEyKm2qya0FEXNk2uYDonkuZGMQdkvQcvF4jhQNp5iPGENAH5dIGpHUltQa0D6f9xZcEb90n6dQVTGx5Ww0DlRuZA3wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"info plist motion usage description\"\n        title=\"info plist motion usage description\"\n        src=\"/static/c714c2041521f0a12d5df1033a40e76b/fcda8/info-plist-motion-usage.png\"\n        srcset=\"/static/c714c2041521f0a12d5df1033a40e76b/12f09/info-plist-motion-usage.png 148w,\n/static/c714c2041521f0a12d5df1033a40e76b/e4a3f/info-plist-motion-usage.png 295w,\n/static/c714c2041521f0a12d5df1033a40e76b/fcda8/info-plist-motion-usage.png 590w,\n/static/c714c2041521f0a12d5df1033a40e76b/3cd52/info-plist-motion-usage.png 857w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3>2. Create an <code>CMMotionActivityManager</code> and <code>CMPedometer</code> instances</h3>\n<pre><code class=\"language-swift\">private let activityManager = CMMotionActivityManager()\nprivate let pedometer = CMPedometer()\n</code></pre>\n<h3>3. Create a method for tracking activity events</h3>\n<pre><code class=\"language-swift\">private func startTrackingActivityType() {\n  activityManager.startActivityUpdates(to: OperationQueue.main) {\n      [weak self] (activity: CMMotionActivity?) in\n\n      guard let activity = activity else { return }\n      DispatchQueue.main.async {\n          if activity.walking {\n              self?.activityTypeLabel.text = \"Walking\"\n          } else if activity.stationary {\n              self?.activityTypeLabel.text = \"Stationary\"\n          } else if activity.running {\n              self?.activityTypeLabel.text = \"Running\"\n          } else if activity.automotive {\n              self?.activityTypeLabel.text = \"Automotive\"\n          }\n      }\n  }\n}\n</code></pre>\n<h3>4. Create a method for steps counting updates</h3>\n<pre><code class=\"language-swift\">private func startCountingSteps() {\n  pedometer.startUpdates(from: Date()) {\n      [weak self] pedometerData, error in\n      guard let pedometerData = pedometerData, error == nil else { return }\n\n      DispatchQueue.main.async {\n          self?.stepsCountLabel.text = pedometerData.numberOfSteps.stringValue\n      }\n  }\n}\n</code></pre>\n<h3>5. Start getting updates</h3>\n<pre><code class=\"language-swift\">private func startUpdating() {\n  if CMMotionActivityManager.isActivityAvailable() {\n      startTrackingActivityType()\n  }\n\n  if CMPedometer.isStepCountingAvailable() {\n      startCountingSteps()\n  }\n}\n</code></pre>\n<img src=\"../../../static/images/coremotion-pedometer-swift/steps-demo.gif\" alt=\"demo\" width=\"300\">\n<h2>Conclusion</h2>\n<p>CoreMotion is a powerful framework and besides a pedometer it allows you to work with a plenty useful data from accelerometer and gyroscope as well\nYou can find an example project at <a href=\"https://github.com/bright/Pedometer-Swift\">Github repository</a></p>\n<p>Hope you like the post, feel free to share and comment.</p>","excerpt":"Ok... but what the pedometer is? Here you have a wikipedia definition: A pedometer is a device, usually portable and electronic or…","frontmatter":{"slug":null,"title":"Implementing a simple pedometer using Swift","description":null,"author":"kwysocki","tags":["iOS","swift","CoreMotion","pedometer","tutorial"],"date":"2017-12-07T23:00:00.000Z","image":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#888888","images":{"fallback":{"src":"/static/fd987c5f63a90bbbd59135aef2ea928c/f3dc5/footsteps.jpg","srcSet":"/static/fd987c5f63a90bbbd59135aef2ea928c/f6fcd/footsteps.jpg 320w,\n/static/fd987c5f63a90bbbd59135aef2ea928c/e70fc/footsteps.jpg 640w,\n/static/fd987c5f63a90bbbd59135aef2ea928c/f3dc5/footsteps.jpg 1280w","sizes":"(min-width: 1280px) 1280px, 100vw"},"sources":[{"srcSet":"/static/fd987c5f63a90bbbd59135aef2ea928c/dde70/footsteps.webp 320w,\n/static/fd987c5f63a90bbbd59135aef2ea928c/62859/footsteps.webp 640w,\n/static/fd987c5f63a90bbbd59135aef2ea928c/f121e/footsteps.webp 1280w","type":"image/webp","sizes":"(min-width: 1280px) 1280px, 100vw"}]},"width":1280,"height":853}}}},"timeToRead":4,"fileAbsolutePath":"/home/runner/work/new-www/new-www/src/mdData/blog/2017-12-08-coremotion-pedometer-swift.md"},"site":{"siteMetadata":{"siteUrl":"https://brightinventions.pl"}}},"pageContext":{"fileAbsolutePath":"/home/runner/work/new-www/new-www/src/mdData/blog/2017-12-08-coremotion-pedometer-swift.md"}},"staticQueryHashes":["2189233960","3181594896"]}