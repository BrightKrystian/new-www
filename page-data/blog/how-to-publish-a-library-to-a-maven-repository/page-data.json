{"componentChunkName":"component---src-templates-post-template-tsx","path":"/blog/how-to-publish-a-library-to-a-maven-repository","result":{"data":{"markdownRemark":{"html":"<p>A seasoned developer now and then creates a piece of code that he or she would like to <em>reuse</em> in a different project. When such time comes it is useful to know how to publish a library so that it can easily be incorporated into a different project. In this post I will describe how to publish a Kotlin library to <a href=\"https://bintray.com/bintray/jcenter\">JCenter</a> with <code>maven-publish</code> and <code>com.jfrog.bintray</code> Gradle plugins.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e6e6537fc6a766e27439c7336dd05a3e/ee745/announce.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 91.21621621621621%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAASABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAECBQP/xAAWAQEBAQAAAAAAAAAAAAAAAAABAgD/2gAMAwEAAhADEAAAAdjpfPidBVTeBZG3/8QAGxAAAQQDAAAAAAAAAAAAAAAAAQIEEBESEyL/2gAIAQEAAQUCpe7ICXA6TYE//8QAFxEBAAMAAAAAAAAAAAAAAAAAAQIRIP/aAAgBAwEBPwGTRj//xAAXEQEAAwAAAAAAAAAAAAAAAAABAhEg/9oACAECAQE/AZNGP//EABwQAAEDBQAAAAAAAAAAAAAAAAACEjEQESAhIv/aAAgBAQAGPwJzuLQTVJvD/8QAGxAAAgIDAQAAAAAAAAAAAAAAAREAIRAgMXH/2gAIAQEAAT8hvWUe4e5MlcGnBBBM6f/aAAwDAQACAAMAAAAQfzcA/8QAFxEBAQEBAAAAAAAAAAAAAAAAAREAEP/aAAgBAwEBPxBaBhp3/8QAFxEBAQEBAAAAAAAAAAAAAAAAAREAEP/aAAgBAgEBPxBrGGl7/8QAGxABAAIDAQEAAAAAAAAAAAAAAREhABAxYYH/2gAIAQEAAT8QTgIA5fU40BJqHu5ZpBSopuMtJLf2tIPQdf/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"publish\"\n        title=\"publish\"\n        src=\"/static/e6e6537fc6a766e27439c7336dd05a3e/1c72d/announce.jpg\"\n        srcset=\"/static/e6e6537fc6a766e27439c7336dd05a3e/a80bd/announce.jpg 148w,\n/static/e6e6537fc6a766e27439c7336dd05a3e/1c91a/announce.jpg 295w,\n/static/e6e6537fc6a766e27439c7336dd05a3e/1c72d/announce.jpg 590w,\n/static/e6e6537fc6a766e27439c7336dd05a3e/ee745/announce.jpg 660w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h1>Gradle Maven plugins</h1>\n<p>The first step is to apply <a href=\"https://docs.gradle.org/current/userguide/maven_plugin.html\">Maven plugin</a>. The plugin adds support for deploying artifacts to Maven repositories. Note that in case of multi-project build e.g. <a href=\"https://github.com/bright/shouldko\">ShouldKO</a> the Maven plugin should be applied to every project that defines some artifact to be published. You can use <code>allprojects</code> to get rid of duplication e.g.:</p>\n<pre><code class=\"language-groovy\">allprojects {\n    repositories {\n        jcenter()\n    }\n\n    apply plugin: 'kotlin'\n    apply plugin: 'maven'\n\n    group \"pl.miensol.shouldko\"\n}\n</code></pre>\n<p>For the <a href=\"https://github.com/bintray/gradle-bintray-plugin\"><code>com.jfrog.bintray</code></a> plugin, used later on, to work nicely with Maven artifacts we need to apply additional Gradle plugin. This additional piece is the <a href=\"https://docs.gradle.org/current/userguide/publishing_maven.html\"><code>maven-publish</code></a> plugin which provides ability to publish artifacts in Maven format. All we need to do is to <code>apply plugin: 'maven-publish'</code> in the main project.</p>\n<h1>Define Maven publishing</h1>\n<p>The <a href=\"https://github.com/bintray/gradle-bintray-plugin#step-7-define-artifacts-to-be-uploaded-to-bintray\"><code>com.jfrog.bintray</code></a> plugin relies on properly defined <a href=\"https://docs.gradle.org/current/userguide/publishing_maven.html\">Maven Publications</a>. The Gradle DSL allows us to define them easily basing on project properties e.g.</p>\n<pre><code class=\"language-groovy\">publishing {\n    publications {\n        hamcrest(MavenPublication) {\n            def project = project(':hamcrest')\n            from project.components.java\n            artifact project.sourcesJar { // not required, includes sourcesJar with correct classifer\n                classifier \"sources\"\n            }\n            groupId group\n            artifactId project.name\n            version project.version\n        }\n\n        core(MavenPublication) {\n            def project = project(':core')\n            from project.components.java\n            artifact project.sourcesJar {\n                classifier \"sources\"\n            }\n            groupId group\n            artifactId project.name\n            version project.version\n        }\n    }\n}\n</code></pre>\n<p>The above Maven Publications include sources artifact. Publishing additional classifiers for artifacts is important since <a href=\"https://stackoverflow.com/a/20909695/155213\">it allows for IDE to show a documentation popup or debug through the library source code</a>.  However, one needs to define it first as it is not included by default when applying <code>java</code> or <code>kotlin</code> plugins to a Gradle project. This is easily done as follows:</p>\n<pre><code class=\"language-groovy\">allprojects {\n    task sourcesJar(type: Jar, dependsOn: classes) {\n        from sourceSets.main.allSource\n    }\n}\n</code></pre>\n<h1>Project versioning</h1>\n<p>As you saw above, we have used <code>project.version</code> to indicate a version to <code>MavenPublication</code>. There are multiple strategies to version software but the <a href=\"https://semver.org/\">Semantic Versioning</a> scheme is widely accepted as a standard when it comes to libraries. If you wish to use it then there are plugins available for Gradle to simplify the mundane tasks of maintaining pre-release and patch versions. I like the set of plugin from <a href=\"https://github.com/ajoberstar/gradle-git/wiki\"><code>ajoberstar</code></a> that provide an opinionated way to version your project based on git tags. Applying them is easy:</p>\n<pre><code class=\"language-groovy\">plugins {\n    id \"org.ajoberstar.grgit\" version \"1.7.2\"\n    id \"org.ajoberstar.release-opinion\" version \"1.7.2\"\n}\n</code></pre>\n<p>Now when you issue e.g. <code>gradle build</code> the plugin will <a href=\"https://github.com/ajoberstar/gradle-git/wiki/Release%20Plugins#how-do-i-use-the-opinion-plugin\">infer a next version based on your git repository state</a>:</p>\n<pre><code>> Configure project : \nInferred project: shouldko, version: 0.1.5-dev.0.uncommitted+4f71d34\n</code></pre>\n<h1>Bintray upload</h1>\n<p>Finally, when we are ready to upload our library and make it available for everyone we need to set up a <a href=\"https://bintray.com/signup/oss\">Bintray account</a>. Once we have it, on the <a href=\"https://bintray.com/profile/edit\">profile</a> page we can access API key required to configure <a href=\"https://github.com/bintray/gradle-bintray-plugin\">the Bintray</a> Gradle plugin.</p>\n<pre><code class=\"language-groovy\">bintray {\n    user = project.hasProperty('bintrayUser') ? project.property('bintrayUser') : System.getenv('BINTRAY_USER')\n    key = project.hasProperty('bintrayApiKey') ? project.property('bintrayApiKey') : System.getenv('BINTRAY_API_KEY')\n    publications = ['core', 'hamcrest']\n    pkg {\n        repo = 'maven'\n        name = 'shouldko'\n        desc = 'Adds source line to tests assertion messages'\n        userOrg = 'brightinventions'\n        licenses = ['MIT']\n        vcsUrl = 'https://github.com/bright/shouldko.git'\n        labels = ['tests', 'hamcrest', 'junit']\n    }\n}\n</code></pre>\n<p><strong>The Bintray API key should be kept private and by no means included in the source code repository.</strong>\nWe can configure <code>user</code> and <code>key</code> by looking at project properties and if not available using environment variables. This way there is no need to expose them publicly. </p>\n<pre><code class=\"language-bash\">gradle build bintrayUpload -PbintrayUser=&#x3C;apiUser> -PbintrayApiKey=&#x3C;apikKey>\n</code></pre>\n<p>The <code>repo</code> is the name of the Bintray repository. You can use the same Bintray repository to host multiple projects.</p>\n<p>The Bintray plugin is very taciturn thus I like to add some log message to see when the <code>bintrayUpload</code> completes:</p>\n<pre><code class=\"language-groovy\">afterEvaluate {\n    tasks.bintrayUpload.doLast {\n        logger.lifecycle(\"Uploaded artifacts to bintray at version $version\")\n    }\n}\n</code></pre>\n<h1>Travis build</h1>\n<p>Every project should have at least some form of <a href=\"https://en.wikipedia.org/wiki/Continuous_integration\">continuous integration</a>. For open source software there are at least couple of free build servers available. <a href=\"https://travis-ci.org\">Travis</a> is probably the most popular one. For gradle project Travis will by default call <code>build</code>. If you would like to upload the build artifacts to Bintray whenever successful build completes you need to add a line to <code>script</code> section of the <code>.travis.yml</code> like so:</p>\n<pre><code class=\"language-yaml\">script:\n  - ./gradlew build\n  - ./gradlew bintrayUpload\n</code></pre>\n<p>Obviously the Bintray credentials need to be configured as well which can be done through a project configuration page:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5145d1832db8b7630b95c819f13733d0/ce0a7/travis-configure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.16216216216216%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA7klEQVQoz6VR2YqEMBDM/3+dzKs3KLpoPJIYjxhrqbDKMOw+bUORTldTqe6I9TxhnIN1J/Rx4PAe/wkxLha9NpDG4EspzIvFvm3YPnAcB5xzAcyJd35dV3jvIeZpwtD3GKWEUQpaKUzTBEXxeX7QNA2qqgpg3nXdw7F/HEfs+w7BC0kpJbTWWJblgTEmnKyXZYk0TZFlGYqiCKLvPEGXgspt2wZBNvwGus3zHHEcI0mSIEpBjmqtDS7Zx3UIqtLqvZ8brJG775/7HIYBURShruvwGXzs9XpBsNn//Ox1XQEM1sj9FZyIbjkqgyen/QahUhvY8eHAfQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"TravisCI environment configuration\"\n        title=\"TravisCI environment configuration\"\n        src=\"/static/5145d1832db8b7630b95c819f13733d0/fcda8/travis-configure.png\"\n        srcset=\"/static/5145d1832db8b7630b95c819f13733d0/12f09/travis-configure.png 148w,\n/static/5145d1832db8b7630b95c819f13733d0/e4a3f/travis-configure.png 295w,\n/static/5145d1832db8b7630b95c819f13733d0/fcda8/travis-configure.png 590w,\n/static/5145d1832db8b7630b95c819f13733d0/efc66/travis-configure.png 885w,\n/static/5145d1832db8b7630b95c819f13733d0/c83ae/travis-configure.png 1180w,\n/static/5145d1832db8b7630b95c819f13733d0/ce0a7/travis-configure.png 1590w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Now, the Gradle git plugin will create a development version and publish it to Bintray on every Travis build.</p>\n<h1>Tag to release</h1>\n<p>Whenever you want to release a new version of the library you now can simply tag a particular version e.g.</p>\n<pre><code class=\"language-bash\">git tag 0.1.4\ngit push origin 0.1.4\n</code></pre>\n<p>After a local or continuos integration build completes you should see a new version in the Bintray web application. From there you need <a href=\"https://bintray.com/docs/usermanual/starting/starting_tutorial2uploading.html\">to publish the version</a>.</p>\n<h1>Use the new library</h1>\n<p>Once a version is published, you can consume it from a maven or gradle project easily. Until you <a href=\"https://bintray.com/bintray/jcenter\">link your package to JCenter</a>, you need to inform your build system about a new maven repository location e.g.:</p>\n<pre><code class=\"language-groovy\">repositories {\n    jcenter()\n    maven { url 'https://dl.bintray.com/brightinventions/maven' }\n}\n</code></pre>\n<p>Note that <code>brightinventions</code> is the organization user name and <code>maven</code> is the repository name mentioned above. You are now, finally able to consume your library 🎉:</p>\n<pre><code class=\"language-groovy\">compile 'pl.miensol.shouldko:hamcrest:0.1.4'\n</code></pre>\n<p>Enjoy!</p>","excerpt":"A seasoned developer now and then creates a piece of code that he or she would like to reuse in a different project. When such time comes it…","frontmatter":{"slug":null,"title":"How to publish a library to a Maven repository with the maven-publish plugin","description":null,"author":"piotr","tags":["maven","jcenter","jvm","gradle","kotlin"],"date":"2018-02-05T23:00:00.000Z","image":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#f8f8f8","images":{"fallback":{"src":"/static/e6e6537fc6a766e27439c7336dd05a3e/5d144/announce.jpg","srcSet":"/static/e6e6537fc6a766e27439c7336dd05a3e/68a1f/announce.jpg 165w,\n/static/e6e6537fc6a766e27439c7336dd05a3e/b4b08/announce.jpg 330w,\n/static/e6e6537fc6a766e27439c7336dd05a3e/5d144/announce.jpg 660w","sizes":"(min-width: 660px) 660px, 100vw"},"sources":[{"srcSet":"/static/e6e6537fc6a766e27439c7336dd05a3e/21e66/announce.webp 165w,\n/static/e6e6537fc6a766e27439c7336dd05a3e/83374/announce.webp 330w,\n/static/e6e6537fc6a766e27439c7336dd05a3e/0a4ba/announce.webp 660w","type":"image/webp","sizes":"(min-width: 660px) 660px, 100vw"}]},"width":660,"height":600}}}},"timeToRead":5,"fileAbsolutePath":"/home/runner/work/new-www/new-www/src/mdData/blog/2018-02-06-how-to-publish-a-library-to-a-maven-repository.md"},"site":{"siteMetadata":{"siteUrl":"https://brightinventions.pl"}}},"pageContext":{"fileAbsolutePath":"/home/runner/work/new-www/new-www/src/mdData/blog/2018-02-06-how-to-publish-a-library-to-a-maven-repository.md"}},"staticQueryHashes":["2189233960","3181594896"]}