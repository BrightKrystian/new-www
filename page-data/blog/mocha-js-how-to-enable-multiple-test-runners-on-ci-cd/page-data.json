{"componentChunkName":"component---src-templates-post-template-tsx","path":"/blog/mocha-js-how-to-enable-multiple-test-runners-on-ci-cd","result":{"data":{"markdownRemark":{"html":"<p>One of our projects is running automated tests on CI/CD AzurePipelines. </p>\n<p>For the test runner, AzurePipeline <a href=\"https://docs.microsoft.com/en-us/azure/devops/pipelines/tasks/test/publish-test-results?view=azure-devops&#x26;tabs=trx%2Cyaml\">supports several</a> test results templates but not the default Mocha spec one. </p>\n<p>This is why tests are running on the mocha Junit reporter producing the JUnit XML result. </p>\n<p>As there was a difference between running tests locally and on CI/CD environment, I wanted to debug the logs of the job. That what not possible as the Mocha JUnit reporter was not collecting console outputs/errors. </p>\n<p>Mocha.js does not support multiple runners right now. The solution for that was to introduce own runner, which combines both Mocha JUnit reporter and default spec Mocha reporter: </p>\n<pre><code class=\"language-javascript\">'use strict';\n\nconst Mocha = require('mocha');\nconst JUnit = require('mocha-junit-reporter');\nconst Spec = Mocha.reporters.Spec;\nconst Base = Mocha.reporters.Base;\n\n// This is combination of spec (mocha normal) + junit reporter so both is displayed on azure\nclass AzurePipelinesReporter extends Base {\n    constructor(runner, options) {\n        super(runner, options);\n        this._junitReporter = new JUnit(runner, options);\n        this._specReporter = new Spec(runner, options);\n    }\n}\nmodule.exports = AzurePipelinesReporter;\n</code></pre>\n<p>Then, the custom reporter can be used by specyfing the file name and flags to both reporters if needed: </p>\n<p><code>mocha --reporter azurePipelinesReporter.js --reporter-options mochaFile=some_path_to_results</code></p>\n<p>Let me know if you had a similar problem, stay tuned for the next tips &#x26; tricks!</p>","excerpt":"One of our projects is running automated tests on CI/CD AzurePipelines.  For the test runner, AzurePipeline supports several test resultsâ€¦","frontmatter":{"slug":null,"title":"Mocha.js - how to enable multiple test runners on CI/CD? ","description":null,"author":"rafal h","tags":["mocha.js","ci/cd","tests","javascript","runner","junit","mocha","ci","cd"],"date":"2021-04-15T11:48:19.197Z","image":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#f8f8f8","images":{"fallback":{"src":"/static/8a3785aa48d04bbcbb34a354376a4b7e/c7636/request_typing.png","srcSet":"/static/8a3785aa48d04bbcbb34a354376a4b7e/1aa8f/request_typing.png 175w,\n/static/8a3785aa48d04bbcbb34a354376a4b7e/65f9b/request_typing.png 350w,\n/static/8a3785aa48d04bbcbb34a354376a4b7e/c7636/request_typing.png 700w","sizes":"(min-width: 700px) 700px, 100vw"},"sources":[{"srcSet":"/static/8a3785aa48d04bbcbb34a354376a4b7e/8b01d/request_typing.webp 175w,\n/static/8a3785aa48d04bbcbb34a354376a4b7e/e8f67/request_typing.webp 350w,\n/static/8a3785aa48d04bbcbb34a354376a4b7e/912fb/request_typing.webp 700w","type":"image/webp","sizes":"(min-width: 700px) 700px, 100vw"}]},"width":700,"height":277}}}},"timeToRead":1,"fileAbsolutePath":"/home/runner/work/new-www/new-www/src/mdData/blog/2021-04-15-mocha-js-how-to-enable-multiple-test-runners-on-ci-cd.md"},"site":{"siteMetadata":{"siteUrl":"https://brightinventions.pl"}}},"pageContext":{"fileAbsolutePath":"/home/runner/work/new-www/new-www/src/mdData/blog/2021-04-15-mocha-js-how-to-enable-multiple-test-runners-on-ci-cd.md"}},"staticQueryHashes":["2189233960","3181594896"]}