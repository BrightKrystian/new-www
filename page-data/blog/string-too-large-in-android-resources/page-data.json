{"componentChunkName":"component---src-templates-post-template-tsx","path":"/blog/string-too-large-in-android-resources","result":{"data":{"markdownRemark":{"html":"<p>I've recently come across a weird and totally unexpected issue while developing an Android app. I bet a lot of people may have enough luck to never notice it but if it finally happens to you and crashes your app, it's quite hard to pinpoint the cause of the issue quickly if you don't know what you are actually looking for.</p>\n<h2>STRING<em>TOO</em>LARGE... what?</h2>\n<p>It seems quite probable that you are not going to know about this problem in your project until you see or experience it yourself so let's start with its symptoms.</p>\n<p>First and foremost, you may see a crash with a stacktrace looking more or less like this:</p>\n<pre><code class=\"language-java\">    android.content.res.Resources$NotFoundException: Drawable com.azabost.stringtoolarge:drawable/ic_my_icon with resource ID #0x7f060057\n    Caused by: android.content.res.Resources$NotFoundException: File res/drawable-anydpi-v24/ic_my_icon.xml from drawable resource ID #0x7f060057\n        at android.content.res.ResourcesImpl.loadDrawableForCookie(ResourcesImpl.java:847)\n        (...)\n     Caused by: java.lang.IllegalArgumentException: R is not a valid verb. Failure occurred at position 2 of path: STRING_TOO_LARGE\n        at android.util.PathParser.nCreatePathDataFromString(Native Method)\n        at android.util.PathParser.access$200(PathParser.java:24)\n        at android.util.PathParser$PathData.&#x3C;init>(PathParser.java:76)\n</code></pre>\n<p>A little less noticable issue is when you try to display a text in the UI and the result of doing so looks like this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/14729dd8c7725c5bedb9f9ab30385721/fcda8/string_too_large_text.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 84.45945945945947%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACOklEQVQ4y5WSzU8TQRiHB4xoPPkXqAcTvZgYIVEkhKsXTTh4wKN60QRj+fKgWFAuxItphDYxRIp3oRYSkYMc3AjBQtLKma90oSuVbrHb7m67j9kpNBJLK4cn85F3nvzemRGn77dxseshZx/do9Hbw5n2u4jbN6i5cwvRdvO/qH/q4dKTdi50PkDU9XdxaqAH4fVw8mU3J150U+v1IJ4/ltR6O6pS4/VwvL+LY32diLrBZ1wdHeJacJjz/lc0vHvDuaFBLo/4aHofQAx0I/o8iP6OyvTt0TDi43pwmJaxAM1jfhpHh2gKDtMc9NMS9FP/9jVXjoCIRqN8mZ3l29wcXxWlRGRxkd+ZDJZpYuZyRUxTrishfiwvoygK3yMRKXWZm58nFoth2zaO41AoFCTu2rKsioi4qrK6tsb6xkaR9XU5unsrq6tFVlbkmNA0echNehjCTfNhfJzPMzNMTk3xMRzm0/Q0k+EwoVCIiVCI8YkJWRONxcjn86XDZROqqko8HieRSKBubqJpmkyZNAzSLrpOeneXVCpFOp0+kLCs0C1MJpOy2J3rus7P7W3SioK9s4Odz2Nblrw/l8NEJeF+YQnTJA8kWltJ+3xYgJnJHEhVMWHZy7VtjK0tfvX2YroP4Tjy28hD1RKW2zSzWWwgs7SEHgjI+b7QPIrwQFuGIUW74TDGwkKx9Wy2qvSfhH+3Lte2LaWmrmPtfZmjt7wvc9t0HHKahhGJYBUKFR/kUGFZqapiplJYVb7OHzn9gnzYfCxxAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"String too large in TextView\"\n        title=\"String too large in TextView\"\n        src=\"/static/14729dd8c7725c5bedb9f9ab30385721/fcda8/string_too_large_text.png\"\n        srcset=\"/static/14729dd8c7725c5bedb9f9ab30385721/12f09/string_too_large_text.png 148w,\n/static/14729dd8c7725c5bedb9f9ab30385721/e4a3f/string_too_large_text.png 295w,\n/static/14729dd8c7725c5bedb9f9ab30385721/fcda8/string_too_large_text.png 590w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>As you can see, in both cases there is that strange <code>STRING_TOO_LARGE</code> either displayed directly in the UI or mentioned in the stacktrace.</p>\n<p>Would you guess how that happened?</p>\n<h2>Reproduction</h2>\n<p>The STRING<em>TOO</em>LARGE issue is pretty easy to reproduce and may happen to you quite unexpectedly. The easiest way is to add a string resource to your app that is longer than 0x7FFF = 32767 characters and then displaying it e.g. in a TextView. That's it! Simple, right?</p>\n<p><em>I recommend generating such a long string using some kind of <a href=\"https://www.lipsum.com/\">lorem ipsum generator</a> rather than writing it yourself 8-)</em></p>\n<p>But if you want to crash your app in a way I have mentioned above, it will be a little more complex. You still have to add a string that large but this time try to put it into the <a href=\"2017-10-19-creating-simple-vector-drawables-in-android-studio.md\">vector drawable</a> <code>android:pathData</code> attribute.</p>\n<p><em>Having vector drawables with very long paths is not recommended and Android Studio or lint should warn you about it, but there is no warning when you exceed the above mentioned limit in a string resource.</em>     </p>\n<h2>How does it happen?</h2>\n<p>The issue is caused by the AAPT/AAPT2 (Android Asset Packaging Tool) which processes your app's resources and replaces them with the <code>STRING_TOO_LARGE</code> value when it finds a large string.</p>\n<p>If you take a look into the APK file affected by this issue, you will find something like this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8900a74084c961a65e8a54dc0bc2155f/2b608/string_res.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.054054054054056%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABHElEQVQY04WP7U6DMBhGuf8L0ivw54zbGDI+BgWB8llg6srMegxV4z99kpM2b5PnPXV8XyDyElHmFLKmbXuUGumHiaZT9MOIyGOOwY44CsmyHCklbdvS9z3DMFBVleXoezh5WiPVSBM/McY+46x4nRVaz7y/jejLRCVLRPaCUsoWrOc0TbYwiiLi0wnf3eFvHnDAYKM1ppFfdzv7AWt0OByov81Wuq6jrmuSJKF4KcizzJY7xsDtZn4rbjfWmTHGsqbpOtphICsKgjhGCEEQBKRpSiWlfV+NPc9bDf+JMcxVhWkapOcRbrfWKgxDiqIgCUMGKVm0xnVdnGVZ+IuP65WmLNHnM+Vuy/P9HWEQ2G+vVsnjhma/Z7lc7KJPwF3DpXvZdj0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Changed string resource\"\n        title=\"Changed string resource\"\n        src=\"/static/8900a74084c961a65e8a54dc0bc2155f/fcda8/string_res.png\"\n        srcset=\"/static/8900a74084c961a65e8a54dc0bc2155f/12f09/string_res.png 148w,\n/static/8900a74084c961a65e8a54dc0bc2155f/e4a3f/string_res.png 295w,\n/static/8900a74084c961a65e8a54dc0bc2155f/fcda8/string_res.png 590w,\n/static/8900a74084c961a65e8a54dc0bc2155f/efc66/string_res.png 885w,\n/static/8900a74084c961a65e8a54dc0bc2155f/c83ae/string_res.png 1180w,\n/static/8900a74084c961a65e8a54dc0bc2155f/2b608/string_res.png 1540w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Or, in case of the vector drawable, something like this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e18e333655b4ba4ef3a5efb1e34f58f0/6aacb/drawable_res.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.189189189189186%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABxklEQVQoz02QS5OaUBSE+f8/JtmksswiM1VGxxEizqgIKPKQh8jlXkBe+qVCZZHedJ1efNWntShKMbcZ1jbD9h3SIiXOE+JbwiWPuYqcJPU4ugbecUfoeySXgCJPEbcMKXLK4jrdRZ6hNY3ANT2WM8nqI6VQIUMv6DtB1wmeo8A6BfxcuswNm7nps9rHGIcrupUxN8+8rBx+zD54ebfR6qokizI2bzHmZ4l5/kWqfG5NyK2JKO7B1HxuHHn/TFgfAlZmjrH12doxm92ZjRWwsUM+nRhNlRIpK+zNDnefs39fc1h85ah/46x/x55/ITz/plYNu2XC7iPlYBlT9hAJVAIaCTyBAU0pSZ6V+LbAOT3wEht5uzDWikGV9HHI1bGppOJkZZjrB2s7Q48MNpcdzdDRPUa6caBu72hKSmQuWc9iFsuRhWsg2pL/lQcBtWNTWC4np8dLGpIyIFMZVVuh7pK6qyib8u+GCnUV6K8XZouBN1dH1MUEej4f0yt5UVBXFWLvUL7ptDdFx5NxHGiHlrZvafqGe39Hi5KcnSdJfEkQgJdGNF39D/icXAjBvb1TtyPBNiT4+oq3esWVPmUtJlDd1TRdwx8kPFIYATI7LgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Changed drawable resource\"\n        title=\"Changed drawable resource\"\n        src=\"/static/e18e333655b4ba4ef3a5efb1e34f58f0/fcda8/drawable_res.png\"\n        srcset=\"/static/e18e333655b4ba4ef3a5efb1e34f58f0/12f09/drawable_res.png 148w,\n/static/e18e333655b4ba4ef3a5efb1e34f58f0/e4a3f/drawable_res.png 295w,\n/static/e18e333655b4ba4ef3a5efb1e34f58f0/fcda8/drawable_res.png 590w,\n/static/e18e333655b4ba4ef3a5efb1e34f58f0/efc66/drawable_res.png 885w,\n/static/e18e333655b4ba4ef3a5efb1e34f58f0/c83ae/drawable_res.png 1180w,\n/static/e18e333655b4ba4ef3a5efb1e34f58f0/6aacb/drawable_res.png 1347w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>which is not a valid vector path, obviously :-D</p>\n<p>If you are interested in the details, here you can find the AAPT2 source code fragment which converts the large strings: <a href=\"https://android.googlesource.com/platform/frameworks/base.git/+/master/tools/aapt2/StringPool.cpp#344\">StringPool.cpp</a></p>\n<h2>Detect the issue before you release it</h2>\n<p>The simplest way to find out if your app is affected is to read the build log carefully looking for the following message:</p>\n<pre><code class=\"language-bash\">error: string too large to encode using UTF-8 written instead as 'STRING_TOO_LARGE'.\n</code></pre>\n<p>Surprisingly, the build process does not fail when it happens.</p>\n<p>If you use a build system like Jenkins, TeamCity or QuickBuild, you should be able to configure the build to fail when such a log message is detected. In case of TeamCity, it's about adding a failure condition like below.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/82de5fb44dcdd657ce5a8659a434df25/96e92/failure_condition.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.2972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABNklEQVQoz21RW26DMBDk/v89Q4/Q/96jUkgRRPiJ3wHbU3lTVJKy0ohFuxrPznRKaUgpIRqEoJ4xBmMtUkpIMSCliBgjQgj0H2Og/hXee3TWCIzjRCTT7QYfIlo55+GdhXAVTCdYswA1g5kKl9pGRSkVtT6jK5vFlgtyzti2DTkXImxqr9ceX5cB/feIEDzu94TFJYS4EuFZdTX7x6g+Furv1xgD3iwQAkopKK2hG5QiW5oF+/6TQm8YGBOYpok820tKjmEYMI4j5nkm9Tv2eiUjwuQllDZ08lGhWCJmxsC5oMD24KRSsNbCOYdSyn9CYxQu/RWcczptXVcauJgptZbennAIf2m32anCWgtSCvTqsiyHk85NP9ZOclTavX8OePu4wFlDhO3is5fP0JZzqRBKw/lA/Q9hSbwWEPv9/gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Failure condition\"\n        title=\"Failure condition\"\n        src=\"/static/82de5fb44dcdd657ce5a8659a434df25/fcda8/failure_condition.png\"\n        srcset=\"/static/82de5fb44dcdd657ce5a8659a434df25/12f09/failure_condition.png 148w,\n/static/82de5fb44dcdd657ce5a8659a434df25/e4a3f/failure_condition.png 295w,\n/static/82de5fb44dcdd657ce5a8659a434df25/fcda8/failure_condition.png 590w,\n/static/82de5fb44dcdd657ce5a8659a434df25/96e92/failure_condition.png 779w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>","excerpt":"I've recently come across a weird and totally unexpected issue while developing an Android app. I bet a lot of people may have enough luck…","frontmatter":{"slug":null,"title":"Watch out for large strings crashing your Android app","description":null,"author":"azabost","tags":["android","large","string","aapt","apk","crash"],"date":"2020-02-21T00:00:00.000Z","image":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#f8f8f8","images":{"fallback":{"src":"/static/e495f3beebadd66fea0e4f8e6618f0cd/a6312/andrzej_watchout-copy.png","srcSet":"/static/e495f3beebadd66fea0e4f8e6618f0cd/e20c6/andrzej_watchout-copy.png 300w,\n/static/e495f3beebadd66fea0e4f8e6618f0cd/62ea7/andrzej_watchout-copy.png 600w,\n/static/e495f3beebadd66fea0e4f8e6618f0cd/a6312/andrzej_watchout-copy.png 1200w","sizes":"(min-width: 1200px) 1200px, 100vw"},"sources":[{"srcSet":"/static/e495f3beebadd66fea0e4f8e6618f0cd/b979a/andrzej_watchout-copy.webp 300w,\n/static/e495f3beebadd66fea0e4f8e6618f0cd/2fa07/andrzej_watchout-copy.webp 600w,\n/static/e495f3beebadd66fea0e4f8e6618f0cd/f9756/andrzej_watchout-copy.webp 1200w","type":"image/webp","sizes":"(min-width: 1200px) 1200px, 100vw"}]},"width":1200,"height":600}}}},"timeToRead":3,"fileAbsolutePath":"/home/runner/work/new-www/new-www/src/mdData/blog/2020-02-21-string-too-large-in-android-resources.md"},"site":{"siteMetadata":{"siteUrl":"https://brightinventions.pl"}}},"pageContext":{"fileAbsolutePath":"/home/runner/work/new-www/new-www/src/mdData/blog/2020-02-21-string-too-large-in-android-resources.md"}},"staticQueryHashes":["2189233960","3181594896"]}