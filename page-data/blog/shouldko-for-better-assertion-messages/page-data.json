{"componentChunkName":"component---src-templates-post-template-tsx","path":"/blog/shouldko-for-better-assertion-messages","result":{"data":{"markdownRemark":{"html":"<p>Most of us write tests these days. Whether they are unit, integration, end-to-end or performance tests once written we often do not go back to them until they fail. It is thus vital to have a clear assertion message when a test fails.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4a564cfa70172bba627886747e14b06a/c08c5/search.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGQABAAMBAQAAAAAAAAAAAAAAAAIDBAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB92E85rcCsLAf/8QAGxABAAICAwAAAAAAAAAAAAAAAQIQABESISP/2gAIAQEAAQUCXRCfKpGyJ60Hef/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABkQAAEFAAAAAAAAAAAAAAAAAAABEBEgYf/aAAgBAQAGPwJ4Fyv/xAAaEAEAAwEBAQAAAAAAAAAAAAABABARQSEx/9oACAEBAAE/Idh7CLWvrN7MwPCjBEn1r//aAAwDAQACAAMAAAAQoMc8/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAHBABAAICAwEAAAAAAAAAAAAAAREhABAxQVHh/9oACAEBAAE/EIsuFHuMElMB3onlBEOTDWFgA9PuuGD09mv/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"search\"\n        title=\"search\"\n        src=\"/static/4a564cfa70172bba627886747e14b06a/1c72d/search.jpg\"\n        srcset=\"/static/4a564cfa70172bba627886747e14b06a/a80bd/search.jpg 148w,\n/static/4a564cfa70172bba627886747e14b06a/1c91a/search.jpg 295w,\n/static/4a564cfa70172bba627886747e14b06a/1c72d/search.jpg 590w,\n/static/4a564cfa70172bba627886747e14b06a/c08c5/search.jpg 640w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h1>Hamcrest</h1>\n<p>I think <a href=\"http://hamcrest.org/\">Hamcrest</a> is the most popular assertion library available in Java and Kotlin ecosystem. Let us look at an oversimplified example of <a href=\"https://martinfowler.com/bliki/ValueObject.html\"><code>Money</code></a> class:</p>\n<pre><code class=\"language-kotlin\">import java.math.BigDecimal\nimport java.util.*\n\ndata class Money(val amount: BigDecimal, val currency: Currency) {\n    operator fun plus(other: Money): Money {\n        if (currency != other.currency) {\n            throw IllegalArgumentException(\"Cannot add $this to $other. Currencies must match.\")\n        }\n\n        // an accidentally introduced bug ðŸ˜ˆ\n        val newAmount = amount + other.amount + 10.0.toBigDecimal()\n        return copy(amount = newAmount)\n    }\n}\n</code></pre>\n<p>Imagine we write a test for the <a href=\"https://kotlinlang.org/docs/reference/operator-overloading.html\"><code>plus</code></a> operator using <a href=\"http://junit.org/junit5/\">JUnit</a> and <a href=\"http://hamcrest.org/\">Hamcrest</a>:</p>\n<pre><code>class MoneyTests {\n    val usd = Currency.getInstance(\"USD\")\n\n    @Test\n    fun can_add() {\n        val usd100 = Money(100.toBigDecimal(), usd)\n        val usd50 = Money(50.toBigDecimal(), usd)\n\n        assertThat((usd100 + usd50).amount, equalTo(150.toBigDecimal()))\n    }\n}\n</code></pre>\n<p>The test will fail with the following message:</p>\n<pre><code>java.lang.AssertionError: \nExpected: &#x3C;150>\n     but: was &#x3C;160>\n</code></pre>\n<p>Let's see how we can improve on that.</p>\n<h1>ShouldKO: better assertion messages for Kotlin</h1>\n<p><a href=\"https://github.com/miensol/shouldko\">ShouldKO</a> is a simple library I've come up with that improves the assertion messages. Its idea is based on assertion libraries available in .NET e.g. <a href=\"https://github.com/shouldly/shouldly\">Shouldly</a>. Let us see how the tests looks like using <a href=\"https://github.com/miensol/shouldko\">ShouldKO</a>:</p>\n<pre><code class=\"language-kotlin\">class MoneyTests {\n    val usd = Currency.getInstance(\"USD\")\n\n    @Test\n    fun can_add() {\n        val usd100 = Money(100.toBigDecimal(), usd)\n        val usd50 = Money(50.toBigDecimal(), usd)\n\n        (usd100 + usd50).amount.shouldEqual(150.toBigDecimal())\n    }\n}\n</code></pre>\n<p>In my opinion <a href=\"https://github.com/miensol/shouldko\">ShouldKO's</a> assertion syntax improves readability. However, this is not where <a href=\"https://github.com/miensol/shouldko\">ShouldKO</a> main improvement is. Follow the improved assertion message:</p>\n<pre><code>java.lang.AssertionError: (usd100 + usd50).amount \nExpected: &#x3C;150>\n     but: was &#x3C;160>\n</code></pre>\n<p><a href=\"https://github.com/miensol/shouldko\">ShouldKO</a> incorporates a source code line with the assertion into the assertion message itself. This comes really handy when we have multiple lines with assertions that form one logical condition. This is a small thing, but can greatly improve debugging test issues especially when all we have is a log file produced by a test run.</p>\n<h2>Installation of ShouldKO</h2>\n<p><a href=\"https://github.com/miensol/shouldko\">ShouldKO</a> is currently available on <a href=\"https://jitpack.io/\">Jitpack</a>. You need to first add Jitpack to your repositories:</p>\n<pre><code class=\"language-groovy\">repositories {\n    maven { url 'https://jitpack.io' }\n    mavenCentral()\n}\n</code></pre>\n<p>And include the library in your tests e.g.:</p>\n<pre><code class=\"language-groovy\">testImplementation 'com.github.miensol.shouldko:hamcrest:v0.1.0'\n</code></pre>\n<p><a href=\"https://github.com/miensol/shouldko\">ShouldKO's</a> Hamcrest library allows for using any Hamcrest matcher.</p>","excerpt":"Most of us write tests these days. Whether they are unit, integration, end-to-end or performance tests once written we often do not go backâ€¦","frontmatter":{"slug":null,"title":"Use ShouldKO for better assertion messages","description":null,"author":"piotr","tags":["junit","hamcreset","kotlin","assertion","tests"],"date":"2018-01-16T23:00:00.000Z","image":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#f8f8f8","images":{"fallback":{"src":"/static/4a564cfa70172bba627886747e14b06a/30f07/search.jpg","srcSet":"/static/4a564cfa70172bba627886747e14b06a/41624/search.jpg 160w,\n/static/4a564cfa70172bba627886747e14b06a/1b894/search.jpg 320w,\n/static/4a564cfa70172bba627886747e14b06a/30f07/search.jpg 640w","sizes":"(min-width: 640px) 640px, 100vw"},"sources":[{"srcSet":"/static/4a564cfa70172bba627886747e14b06a/60b4d/search.webp 160w,\n/static/4a564cfa70172bba627886747e14b06a/5e011/search.webp 320w,\n/static/4a564cfa70172bba627886747e14b06a/90d07/search.webp 640w","type":"image/webp","sizes":"(min-width: 640px) 640px, 100vw"}]},"width":640,"height":640}}}},"timeToRead":2,"fileAbsolutePath":"/home/runner/work/new-www/new-www/src/mdData/blog/2018-01-17-shouldko-for-better-assertion-messages.md"},"site":{"siteMetadata":{"siteUrl":"https://brightinventions.pl"}}},"pageContext":{"fileAbsolutePath":"/home/runner/work/new-www/new-www/src/mdData/blog/2018-01-17-shouldko-for-better-assertion-messages.md"}},"staticQueryHashes":["2189233960","3181594896"]}